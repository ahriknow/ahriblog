(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{278:function(s,t,a){s.exports=a.p+"assets/img/master&worker.07aebb02.png"},279:function(s,t,a){s.exports=a.p+"assets/img/master-principle.135896e2.png"},354:function(s,t,a){"use strict";a.r(t);var n=a(19),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"本页目录"}},[s._v("本页目录")]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#本页目录"}},[s._v("本页目录")])]),n("li",[n("a",{attrs:{href:"#master-worker"}},[s._v("Master & worker")])])])]),n("p"),s._v(" "),n("h2",{attrs:{id:"master-worker"}},[s._v("Master & worker")]),s._v(" "),n("h4",{attrs:{id:"原理图"}},[s._v("原理图")]),s._v(" "),n("p",[n("img",{attrs:{src:a(278),alt:"master&worker.png"}})]),s._v(" "),n("h4",{attrs:{id:"nginx-进程"}},[s._v("nginx 进程")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef | grep nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master")]),s._v("\nroot       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3401")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 04:28 ?        00:00:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# worker 可以多个")]),s._v("\nnginx      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3402")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3401")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 04:28 ?        00:00:00 nginx: worker process\n\nroot       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3406")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1968")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 04:48 pts/0    00:00:00 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" --color"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"master-工作原理"}},[s._v("master 工作原理")]),s._v(" "),n("p",[n("img",{attrs:{src:a(279),alt:"master-principle.png"}})]),s._v(" "),n("h4",{attrs:{id:"master-worker-优点"}},[s._v("master&worker 优点")]),s._v(" "),n("ul",[n("li",[s._v("使用 "),n("code",[s._v("nginx -s reload")]),s._v(" 热部署")]),s._v(" "),n("li",[s._v("每个 worker 是独立的进程，其中一个出现问题，不会造成服务中断")])]),s._v(" "),n("h4",{attrs:{id:"worker-的个数"}},[s._v("worker 的个数")]),s._v(" "),n("p",[s._v("Nginx 和 redis 类似，都采用了 io 多路复用，每个 worker 都是一个独立的进程，但每个进程里只有一个主线程，通过异步非阻塞的方式来处理请求。")]),s._v(" "),n("p",[s._v("每个 worker 可以将一个 cpu 的性能发挥到极致，所以 worker 数和 cpu 数相等是最适宜的。")]),s._v(" "),n("p",[s._v("Windows 系统没有 io 多路复用及至。")]),s._v(" "),n("h4",{attrs:{id:"设置-worker-的个数"}},[s._v("设置 worker 的个数")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("worker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或")]),s._v("\nworker_cpu_affinity 0001 0010 0100 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4 个 cpu 绑定 4 个")]),s._v("\nworker_cpu_affinity 00000001 00000010 00000100 00001000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 8 个 cpu 绑定 4 个")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"worker-连接数"}},[s._v("worker 连接数")]),s._v(" "),n("p",[s._v("每个 worker 的最大连接数是 1024")]),s._v(" "),n("p",[s._v("worker 处理一个请求，占用 2 个或 4 个 连接数（静态 2 个，其他服务又 2 个）")]),s._v(" "),n("p",[s._v("1 个 master，4 个 worker，支持的最大并发量是 "),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("mn",[s._v("4")]),n("mo",[s._v("∗")]),n("mn",[s._v("1")]),n("mn",[s._v("0")]),n("mn",[s._v("2")]),n("mn",[s._v("4")]),n("mi",{attrs:{mathvariant:"normal"}},[s._v("/")]),n("mn",[s._v("2")])],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("4*1024/2")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.75em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"1em","vertical-align":"-0.25em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord mathrm"},[s._v("4")]),n("span",{staticClass:"mbin"},[s._v("∗")]),n("span",{staticClass:"mord mathrm"},[s._v("1")]),n("span",{staticClass:"mord mathrm"},[s._v("0")]),n("span",{staticClass:"mord mathrm"},[s._v("2")]),n("span",{staticClass:"mord mathrm"},[s._v("4")]),n("span",{staticClass:"mord mathrm"},[s._v("/")]),n("span",{staticClass:"mord mathrm"},[s._v("2")])])])]),s._v(" 或 "),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("mn",[s._v("4")]),n("mo",[s._v("∗")]),n("mn",[s._v("1")]),n("mn",[s._v("0")]),n("mn",[s._v("2")]),n("mn",[s._v("4")]),n("mi",{attrs:{mathvariant:"normal"}},[s._v("/")]),n("mn",[s._v("4")])],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("4*1024/4")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.75em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"1em","vertical-align":"-0.25em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord mathrm"},[s._v("4")]),n("span",{staticClass:"mbin"},[s._v("∗")]),n("span",{staticClass:"mord mathrm"},[s._v("1")]),n("span",{staticClass:"mord mathrm"},[s._v("0")]),n("span",{staticClass:"mord mathrm"},[s._v("2")]),n("span",{staticClass:"mord mathrm"},[s._v("4")]),n("span",{staticClass:"mord mathrm"},[s._v("/")]),n("span",{staticClass:"mord mathrm"},[s._v("4")])])])])]),s._v(" "),n("Valine")],1)}),[],!1,null,null,null);t.default=r.exports}}]);