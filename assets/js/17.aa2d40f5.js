(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{277:function(s,t,a){s.exports=a.p+"assets/img/redistype.e306687f.png"},328:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"本页目录"}},[s._v("本页目录")]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#本页目录"}},[s._v("本页目录")])]),n("li",[n("a",{attrs:{href:"#核心数据类型"}},[s._v("核心数据类型")]),n("ul",[n("li",[n("a",{attrs:{href:"#string"}},[s._v("String")])]),n("li",[n("a",{attrs:{href:"#hash"}},[s._v("Hash")])]),n("li",[n("a",{attrs:{href:"#list"}},[s._v("List")])]),n("li",[n("a",{attrs:{href:"#set"}},[s._v("Set")])])])]),n("li",[n("a",{attrs:{href:"#分布式锁应用场景-a-name-分布式锁应用场景-a"}},[s._v("分布式锁应用场景"),n("a",{attrs:{name:"分布式锁应用场景"}})])])])]),n("p"),s._v(" "),n("h2",{attrs:{id:"核心数据类型"}},[s._v("核心数据类型")]),s._v(" "),n("p",[n("img",{attrs:{src:a(277),alt:"redistype.png"}})]),s._v(" "),n("h3",{attrs:{id:"string"}},[s._v("String")]),s._v(" "),n("ul",[n("li",[s._v("常用操作")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("操作")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("SET key value")]),s._v(" "),n("td",[s._v("存入字符串键值对")])]),s._v(" "),n("tr",[n("td",[s._v("MSET key value [key value ...]")]),s._v(" "),n("td",[s._v("批量存入字符串键值对")])]),s._v(" "),n("tr",[n("td",[s._v("SETNX key value")]),s._v(" "),n("td",[s._v("存入一个不存在的字符串键值对")])]),s._v(" "),n("tr",[n("td",[s._v("GET key")]),s._v(" "),n("td",[s._v("读取字符串键值对")])]),s._v(" "),n("tr",[n("td",[s._v("MGET key [key ...]")]),s._v(" "),n("td",[s._v("批量读取字符串键值对")])]),s._v(" "),n("tr",[n("td",[s._v("DEL key [key ...]")]),s._v(" "),n("td",[s._v("删除键值对")])]),s._v(" "),n("tr",[n("td",[s._v("EXPIRE key seconds")]),s._v(" "),n("td",[s._v("设置 key 过期时间 (秒)")])])])]),s._v(" "),n("ul",[n("li",[s._v("原子加减")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("操作")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("INCR key")]),s._v(" "),n("td",[s._v("将 key 中存储的数字加一")])]),s._v(" "),n("tr",[n("td",[s._v("DECR key")]),s._v(" "),n("td",[s._v("将 key 中存储的数字减一")])]),s._v(" "),n("tr",[n("td",[s._v("INCRBY key increment")]),s._v(" "),n("td",[s._v("将 key 中存储的数字加 increment")])]),s._v(" "),n("tr",[n("td",[s._v("DNCRBY key decrement")]),s._v(" "),n("td",[s._v("将 key 中存储的数字减 decrement")])])])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("应用场景")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("单值缓存")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("SET key value\nGET key\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("对象缓存")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("SET key:1 value "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# json 格式")]),s._v("\nMSET key:1:n1 value1 key:2:n1 value2\nMGET key:1:n1 key:2:n1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("分布式锁")]),s._v(" "),n("p",[n("a",{attrs:{href:"#分布式锁应用场景"}},[s._v("↓↓ 分布式锁应用场景")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("SETNX product:10001 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回 1 获取锁成功，0 失败")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行业务 ...")]),s._v("\nDEL product:10001 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 释放锁")]),s._v("\nSET product:10001 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" ex "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" nx "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 防止程序意外终止导致死锁")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("计数器")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("INCR article:readcount:id1\nGET article:readcount:id1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("分布式系统全局序列号")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("INCRBY orderId "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("Web 集群 session 共享")])])])])]),s._v(" "),n("h3",{attrs:{id:"hash"}},[s._v("Hash")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("优点")]),s._v(" "),n("ol",[n("li",[s._v("同类数据归类整合，方便管理")]),s._v(" "),n("li",[s._v("相比 string 消耗内存与 cpu 更少")]),s._v(" "),n("li",[s._v("相比 string 更节省空间")])])]),s._v(" "),n("li",[n("p",[s._v("缺点")]),s._v(" "),n("ol",[n("li",[s._v("过期功能只能用在 key 上")]),s._v(" "),n("li",[s._v("集群架构下不适合大规模使用(数据会集中到一个 master)")])])]),s._v(" "),n("li",[n("p",[s._v("常用操作")])])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("操作")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("HSET key field value")]),s._v(" "),n("td",[s._v("存入一个哈希表 key 的键值")])]),s._v(" "),n("tr",[n("td",[s._v("HSETNX key field value")]),s._v(" "),n("td",[s._v("存入一个不存在的哈希表 key 的键值")])]),s._v(" "),n("tr",[n("td",[s._v("HMSET key field value [field value ...]")]),s._v(" "),n("td",[s._v("在一个哈希表 key 中存入多个键值")])]),s._v(" "),n("tr",[n("td",[s._v("HGET key field")]),s._v(" "),n("td",[s._v("获取哈希表 key 对应的 field 键值")])]),s._v(" "),n("tr",[n("td",[s._v("HMGET key field [field ...]")]),s._v(" "),n("td",[s._v("批量获取哈希表 key 对应的 field 键值")])]),s._v(" "),n("tr",[n("td",[s._v("DEL key field [field ...]")]),s._v(" "),n("td",[s._v("删除哈希表 key 中的 field 键值")])]),s._v(" "),n("tr",[n("td",[s._v("HLEN key")]),s._v(" "),n("td",[s._v("获取哈希表 key 中 field 的数量")])]),s._v(" "),n("tr",[n("td",[s._v("HGETALL key")]),s._v(" "),n("td",[s._v("获取哈希表 key 中多有键值")])]),s._v(" "),n("tr",[n("td",[s._v("HINCRBY key field increment")]),s._v(" "),n("td",[s._v("哈希表 key 中的 field 键值增加 increment")])])])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("应用场景")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("对象缓存")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("HMSET user "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("userId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":name username "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("userId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":age "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\nHMGET user "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("userId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("userId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":age\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("例: 电商购物车"),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户id为key")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 商品id为field")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 商品数量为value")]),s._v("\nHSET cart:1001 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加商品")]),s._v("\nHINCRBY cart:1001 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加商品")]),s._v("\nHLEN cart:1001 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 商品数量")]),s._v("\nHDEL cart:1001 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除商品")]),s._v("\nHGETALL cart:1001 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取购物车所有商品")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])])])]),s._v(" "),n("li",[n("p",[s._v("分布式锁")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("SETNX product:10001 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回 1 获取锁成功，0 失败")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行业务 ...")]),s._v("\nDEL product:10001 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 释放锁")]),s._v("\nSET product:10001 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" ex "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" nx "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 防止程序意外终止导致死锁")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])])])])]),s._v(" "),n("h3",{attrs:{id:"list"}},[s._v("List")]),s._v(" "),n("ul",[n("li",[s._v("常用操作")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("操作")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("LPUSH key value [value ...]")]),s._v(" "),n("td",[s._v("将一个或多个 value 插入到 key 列表的表头")])]),s._v(" "),n("tr",[n("td",[s._v("RPUSH key value [value ...]")]),s._v(" "),n("td",[s._v("将一个或多个 value 插入到 key 列表的表尾")])]),s._v(" "),n("tr",[n("td",[s._v("LPOP key")]),s._v(" "),n("td",[s._v("移除并返回 key 列表的头元素")])]),s._v(" "),n("tr",[n("td",[s._v("RPOP key")]),s._v(" "),n("td",[s._v("移除并返回 key 列表的尾元素")])]),s._v(" "),n("tr",[n("td",[s._v("LRANGE key start stop")]),s._v(" "),n("td",[s._v("返回列表 key 中指定区间内的元素")])]),s._v(" "),n("tr",[n("td",[s._v("BLPOP key [key ...] timeout")]),s._v(" "),n("td",[s._v("从 key 列表表头弹出一个元素，若列表没有元素，阻塞等待 timeout 秒，timeout 为 0 则一直等待")])]),s._v(" "),n("tr",[n("td",[s._v("BLPOP key [key ...] timeout")]),s._v(" "),n("td",[s._v("从 key 列表表尾弹出一个元素，若列表没有元素，阻塞等待 timeout 秒，timeout 为 0 则一直等待")])])])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("应用场景")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("数据结构")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("Stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("栈"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LPUSH + LPOP -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" FILO\nQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("队列"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LPUSH + RPOP -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" FIFO\nBlocking MQ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("阻塞队列"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LPUSH + BRPOP\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("信息流")]),s._v(" "),n("ul",[n("li",[s._v("例: 微博消息、微信公众号消息、美团、滴滴"),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A 发微博 ID 为 10000")]),s._v("\nLPUSH msg:userId "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# B 发微博 ID 为 10001")]),s._v("\nLPUSH msg:userId "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看最新微博")]),s._v("\nLRANGE msg:userId "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])])])])])])]),s._v(" "),n("h3",{attrs:{id:"set"}},[s._v("Set")]),s._v(" "),n("ul",[n("li",[s._v("常用操作")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("操作")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("SADD key member [member ...]")]),s._v(" "),n("td",[s._v("往集合中存入元素，元素存在则忽略，key 不存在则新建")])]),s._v(" "),n("tr",[n("td",[s._v("SREM key member [member ...]")]),s._v(" "),n("td",[s._v("从集合 key 中删除元素")])]),s._v(" "),n("tr",[n("td",[s._v("SMEMBERS key")]),s._v(" "),n("td",[s._v("获取集合 key 中所有元素")])]),s._v(" "),n("tr",[n("td",[s._v("SCARD key")]),s._v(" "),n("td",[s._v("获取集合 key 中元素个数")])]),s._v(" "),n("tr",[n("td",[s._v("SISMEMBER key member")]),s._v(" "),n("td",[s._v("判断 member 元素是否存在于集合 key 中")])]),s._v(" "),n("tr",[n("td",[s._v("SRANDMEMBER key count")]),s._v(" "),n("td",[s._v("从集合 key 中复制出 count 个元素")])]),s._v(" "),n("tr",[n("td",[s._v("SPOP key count")]),s._v(" "),n("td",[s._v("从集合 key 中取出 count 个元素")])])])]),s._v(" "),n("ul",[n("li",[s._v("运算符操作")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("操作")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("SINTER key [key ...]")]),s._v(" "),n("td",[s._v("交集运算")])]),s._v(" "),n("tr",[n("td",[s._v("SINTERSTORE destination key [key ...]")]),s._v(" "),n("td",[s._v("将交集的结果存入新集合 destination 中")])]),s._v(" "),n("tr",[n("td",[s._v("SUNION key [key ...]")]),s._v(" "),n("td",[s._v("并集运算")])]),s._v(" "),n("tr",[n("td",[s._v("SUNIONSTORE destination key [key ...]")]),s._v(" "),n("td",[s._v("将并集的结果存入新集合 destination 中")])]),s._v(" "),n("tr",[n("td",[s._v("SDIFF key [key ...]")]),s._v(" "),n("td",[s._v("差集运算")])]),s._v(" "),n("tr",[n("td",[s._v("SDIFFSTORE destination key [key ...]")]),s._v(" "),n("td",[s._v("将差集的结果存入新集合 destination 中")])])])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("应用场景")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("抽奖程序")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 点击参与抽奖  act:1 一号抽奖  1000 用户id")]),s._v("\nSADD act:1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看参与抽 act:1 奖的所有用户")]),s._v("\nSMEMBERS act:1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选取 count 名获奖者")]),s._v("\nSRANDMEMBER act:1 count "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单次抽奖")]),s._v("\nSPOP act:1 count "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多级抽奖")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("点赞、收藏")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 点赞")]),s._v("\nSADD like:msgId userId\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消点赞")]),s._v("\nSREM like:msgId userId\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看用户是否点赞")]),s._v("\nSISMEMBER like:msgId userId\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取点赞的用户列表")]),s._v("\nSMEMBERS like:msgId\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取点赞数")]),s._v("\nSCARD like:msgId\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("关注")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A 关注了 abc")]),s._v("\nASet -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" B, C, D "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# B 关注了 abcd")]),s._v("\nBSet -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" A, C, D, E "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# C 关注了 bcde")]),s._v("\nCSet -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" A, B, C, D, E "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AB 共同关注")]),s._v("\nSINTER ASet BSet -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" C, D "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A 关注的 B 是否也关注了 C, D")]),s._v("\nSISMEMBER BSet C\nSISMEMBER BSet D\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A 可能通过 B 认识的人")]),s._v("\nSDIFF ASet BSet -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", E "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])])])])]),s._v(" "),n("h2",{attrs:{id:"分布式锁应用场景"}},[s._v("分布式锁应用场景"),n("a",{attrs:{name:"分布式锁应用场景"}})]),s._v(" "),n("h4",{attrs:{id:"抢票"}},[s._v("抢票")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" time\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" uuid\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" threading "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Thread\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" redis\n\nredis_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                           port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# password=123,")]),s._v("\n                           db"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取锁")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lock_name：锁定名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# acquire_time: 客户端等待获取锁的时间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time_out: 锁的超时时间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire_lock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" acquire_time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time_out"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取一个分布式锁"""')]),s._v("\n    identifier "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uuid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uuid4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    end "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" acquire_time\n    lock "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string:lock:"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" lock_name\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" end"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" redis_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setnx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" identifier"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给锁设置超时时间, 防止进程崩溃导致其他进程无法获取锁")]),s._v("\n            redis_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expire"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" identifier\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" redis_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ttl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            redis_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expire"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#释放锁")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("release_lock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" identifier"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""释放一个分布式锁"""')]),s._v("\n    lock "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string:lock:"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" lock_name\n    pip "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pipeline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            pip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("watch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            lock_value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" lock_value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" lock_value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" identifier"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                pip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("multi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                pip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                pip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n            pip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("unwatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("excetions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WacthcError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n\ncount"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("seckill")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    identifier"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("acquire_lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'resource'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"线程:{}--获得了锁"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" count\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"线程:{}--没抢到，票抢完了"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n    count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"线程:{}--抢到一张票，还剩{}张票"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    release_lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'resource'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("identifier"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("target"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("seckill"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br")])]),n("Valine")],1)}),[],!1,null,null,null);t.default=e.exports}}]);