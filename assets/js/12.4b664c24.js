(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{226:function(v,a,s){"use strict";s.r(a);var l=s(2),r=Object(l.a)({},(function(){var v=this,a=v.$createElement,s=v._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[s("h2",{attrs:{id:"lvs概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs概念"}},[v._v("#")]),v._v(" LVS概念:")]),v._v(" "),s("h4",{attrs:{id:"lvs-集群类型中的术语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs-集群类型中的术语"}},[v._v("#")]),v._v(" lvs 集群类型中的术语:")]),v._v(" "),s("ul",[s("li",[v._v("VS: Virtual Server(lvs), Director Server(DS)\n"),s("ul",[s("li",[v._v("Dispantcher(调度器), Load Balancer")])])]),v._v(" "),s("li",[v._v("RS: Real Server(lvs), upstream server(nginx)\n"),s("ul",[s("li",[v._v("backend server(haproxy)")])])]),v._v(" "),s("li",[v._v("CIP: Client IP")]),v._v(" "),s("li",[v._v("VIP: Virtual server IP")]),v._v(" "),s("li",[v._v("DIP: Director IP")]),v._v(" "),s("li",[v._v("RIP: Real server IP")]),v._v(" "),s("li",[v._v("访问流程: CIP <--\x3e VIP == DIP <--\x3e RIP")])]),v._v(" "),s("h2",{attrs:{id:"lvs集群的类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs集群的类型"}},[v._v("#")]),v._v(" lvs集群的类型:")]),v._v(" "),s("h4",{attrs:{id:"lvs-ipvsadm-ipvsadm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs-ipvsadm-ipvsadm"}},[v._v("#")]),v._v(" lvs: ipvsadm/ipvsadm")]),v._v(" "),s("ul",[s("li",[v._v("ipvsadm: 用户空间的命令行工具, 规则管理器, 用于管理集群服务及RealServer")]),v._v(" "),s("li",[v._v("ipvs: 工作与内核空间netfilter的INPUT钩子上的框架")])]),v._v(" "),s("h4",{attrs:{id:"lvs集群的类型-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs集群的类型-2"}},[v._v("#")]),v._v(" lvs集群的类型:")]),v._v(" "),s("ul",[s("li",[v._v("lvs-nat: 修改请求报文的目标IP, 多目标IP的DNAT")]),v._v(" "),s("li",[v._v("lvs-dr: 操纵封装新的MAC地址")]),v._v(" "),s("li",[v._v("lvs-tun: 在原请求IP报文之外新加一个IP首部")]),v._v(" "),s("li",[v._v("lvs-fullnat: 修改请求报文的源和目标IP")])]),v._v(" "),s("h2",{attrs:{id:"lvs-nat模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs-nat模式"}},[v._v("#")]),v._v(" lvs-nat模式:")]),v._v(" "),s("h4",{attrs:{id:"lvs-nat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs-nat"}},[v._v("#")]),v._v(" lvs-nat:")]),v._v(" "),s("p",[v._v("本质是多目标IP的DNAT, 通过将请求报文中的目标地址和目标端口修改为某挑出的RS的RIP和PORT实现转发")]),v._v(" "),s("ul",[s("li",[v._v("RIP和DIP应在同一个IP网络, 且应使用私网地址, RS的网关要只想DIP")]),v._v(" "),s("li",[v._v("请求报文和相应报文都必须经由Director转发, Director易于成为系统瓶颈")]),v._v(" "),s("li",[v._v("支持端口映射, 可修改请求报文的目标PORT")]),v._v(" "),s("li",[v._v("VS必须是Linux系统, RS可以是任意OS")])]),v._v(" "),s("h2",{attrs:{id:"lvs-dr模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs-dr模式"}},[v._v("#")]),v._v(" lvs-dr模式:")]),v._v(" "),s("h4",{attrs:{id:"lvs-dr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvs-dr"}},[v._v("#")]),v._v(" lvs-dr:")]),v._v(" "),s("p",[v._v("Direct Routing, 直接路由, LVS默认模式, 应用最广泛, 通过为请求报文重新封装一个MAC首部进行转发\n, 源MAC是DIP所在的接口的MAC, 目标MAC是某挑选出的RS的RIP所在接口的MAC地址, 以及目标IP/PORT均保持不变")]),v._v(" "),s("ul",[s("li",[v._v("Director和各RS都配置有VIP")]),v._v(" "),s("li",[v._v("确保前端路由器将目标IP为VIP的请求报文法网Director\n"),s("ul",[s("li",[v._v("在前端网关做静态绑定VIP和Director的MAC地址")]),v._v(" "),s("li",[v._v("在RS上使用arptables工具\n"),s("ul",[s("li",[s("code",[v._v("arptables -A IN -d $VIP -j DROP")])]),v._v(" "),s("li",[s("code",[v._v("arptables -A OUT -s $VIP -j mangle --mangle-ip-s $RIP")])])])]),v._v(" "),s("li",[v._v("在RS上修改内核参数以限制arp通告及应答级别\n"),s("ul",[s("li",[s("code",[v._v("/prop/sys/net/ipv4/conf/all/arp_ignore")])]),v._v(" "),s("li",[s("code",[v._v("/prop/sys/net/ipv4/conf/all/arp_announce")])])])])])])]),v._v(" "),s("Valine")],1)}),[],!1,null,null,null);a.default=r.exports}}]);